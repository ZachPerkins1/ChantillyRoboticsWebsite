<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Page Editor</title>
    <style>
        .list-selection {
            width: 605px;
            height: 200px;
            outline: 1px solid #a7a7a7;
            overflow-y: scroll;
            overflow-x: hidden;
            resize: vertical;
        }
        
        .list {
            
        }
        
        textarea {
            resize: vertical;
            width: 350px;
            height: 15px;
        }
        
        .text {
            width: 600px;
            height: 75px;
        }
        
        .image {
            width: 600px;
            height: 15px;
        }
        
        table td {
            vertical-align: top;
        }
    </style>
    {% macro jsescape(str) -%}
        {{ str|replace('\"', '\\\"')|replace('\n', '\\n')|replace('\r', '\\r') }}
    {%- endmacro %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script>
        var $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};

        var texts = {}
        {% for text in data["texts"] %}
            texts["{{ text['name'] }}"]= {"data":"{{ jsescape(text['data']) }}", "display":"{{ jsescape(text['display']) }}"}
        {% endfor %}
        var lists = {}
        {% for list in data["lists"] %}
            lists["{{ list['name'] }}"] = {}
            {% for var in list["data"] %}
                lists["{{ list['name'] }}"]["{{ var['name'] }}"] = {"data":[
                    {% for entry in var["data"] -%}
                        {{ ',' if loop.index > 1 else '' }}
                        "{{ jsescape(entry) }}"
                    {%- endfor %}
                ], "display":"{{ jsescape(var['display']) }}"}
            {% endfor %}
            lists["{{ list['name'] }}"]["_count"] = {{ list["count"] }}
            lists["{{ list['name'] }}"]["_display"] ="{{ list['display'] }}"
        {% endfor %}
    </script>
    <script type="text/javascript" src="{{ url_for("static", filename="js/admin.js") }}"></script>
</head>
<body onload="start()">
    <h1>{{ data['page_name'] }}</h1>
        <h3>Text Elements</h3>
        <div id="texts">
        {% for text in data["texts"] %}
            {{ text["display"] }}:<br/>
            <textarea name="{{ text["name"] }}" class="text">{{ text["data"] }}</textarea>
            <br/>
            <br/>
        {% endfor %}
        </div>
        <h3>Lists</h3>
        <div id="lists">
        </div>
        <br/>
        <br/>
        <h3>Images</h3>
        Name:<br/>
        <textarea name="" class="image" form="edit-page"></textarea>
        <br/>
        <br/>
        
        <button onclick="save('{{ data['page_name'] }}')">Save</button>
        <button>View Preview</button>
        <div id="message-box"></div>
</body>
</html>